var v=Object.defineProperty;var y=(C,e,t)=>e in C?v(C,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):C[e]=t;var i=(C,e,t)=>(y(C,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();class w{constructor(e,t){i(this,"toGarage");i(this,"toWinners");i(this,"container");this.toWinners=t,this.toGarage=e,this.container=null,this.init()}init(){this.createHtml()}createHtml(){this.container=document.createElement("section"),this.container.classList.add("controls-container");const e=document.createElement("button");e.classList.add("garage-btn"),e.innerHTML="Garage",e.addEventListener("click",()=>this.goToGarage());const t=document.createElement("button");t.classList.add("win-btn"),t.innerHTML="Winners",t.addEventListener("click",()=>this.goToWinners()),this.container.append(e,t)}goToGarage(){this.toGarage()}goToWinners(){this.toWinners()}getControls(){return this.container}}class h{static async getCars(e,t){const a=await fetch(`${this._url}/garage/?_page=${t}&_limit=${e}`,{method:"GET"}),n=a.headers.get("X-Total-Count");return!e||!t?n:await a.json()}static async updateCar(e,t,a,n,r){return await(await fetch(`${this._url}/garage/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e||n,color:t||r})})).json()}static async deleteCar(e){return await(await fetch(`${this._url}/garage/${e}`,{method:"DELETE"})).json()}static async createCar(e,t){return await(await fetch(`${this._url}/garage/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,color:t})})).json()}static async randomCars(){for(let e=0;e<100;e++){const t=this.getRandomCar(),a=t.randomMark+" "+t.randomModel;await this.createCar(a,t.hexColor)}}static async startStopEngine(e,t){try{return await(await fetch(`${this._url}/engine/?id=${e}&status=${t}`,{method:"PATCH"})).json()}catch(a){console.log(a)}}static async switchToDrive(e,t,a){const n=await fetch(`${this._url}/engine/?id=${e}&status=${t}`,{method:"PATCH"});if(n.ok)return await n.json();if(n.status===500)return a()}static async getWinner(e){let t=await fetch(`${this._url}/winners/?id=${e}`,{method:"GET"});return e||(t=await fetch(`${this._url}/winners/`,{method:"GET"})),await t.json()}static async createWinner(e,t,a,n){return await(await fetch(`${this._url}/winners/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,name:t,time:a,wins:n})})).json()}static async deleteWinner(e){return await(await fetch(`${this._url}/winners/${e}`,{method:"DELETE"})).json()}static async updateWinner(e,t,a,n){return await(await fetch(`${this._url}/winners/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,wins:t,time:a})})).json()}static getRandomCar(){const e=["BMW","Lotus","Pininfarina","McLaren","Koenigsegg","Chevrolet","McLaren","Aston Martin","Porsche","Rimac"],t=["M Hybrid V8","Evija","Battista","Speedtail","Regera","Corvette C8","Artura","Valkyrie","918 Spyder","Nevera"],a="0123456789ABCDEF";let n="#";for(let o=0;o<6;o++)n+=a[Math.floor(Math.random()*16)];const r=e[Math.floor(Math.random()*e.length)],s=t[Math.floor(Math.random()*t.length)];return{randomMark:r,randomModel:s,hexColor:n}}}i(h,"_url","http://localhost:3000");class b{constructor(){i(this,"container");i(this,"controlsCon");i(this,"carContainer");i(this,"data");i(this,"selected");i(this,"page");i(this,"garage");i(this,"carNameValue");i(this,"carColorValue");i(this,"changedCarNameValue");i(this,"changedCarColorValue");i(this,"intervals");this.data=null,this.garage=null,this.page=1,this.carNameValue="",this.carColorValue="",this.changedCarNameValue="",this.changedCarColorValue="",this.container=null,this.controlsCon=null,this.carContainer=null,this.selected=null,this.intervals=[],this.init()}init(){this.getLocalData(),this.createHtml(),this.removeSelected()}removeSelected(){document.addEventListener("click",e=>{const t=document.getElementsByClassName("selected");t&&e.target!==document.getElementById("btn-select")&&[...t].forEach(a=>a.classList.remove("selected"))})}getLocalData(){localStorage.getItem("page")!==null&&(this.page=Number(localStorage.getItem("page"))),localStorage.getItem("carNameValue")!==null&&(this.carNameValue=String(localStorage.getItem("carNameValue"))),localStorage.getItem("carColorValue")!==null&&(this.carColorValue=String(localStorage.getItem("carColorValue"))),localStorage.getItem("changedCarNameValue")!==null&&(this.changedCarNameValue=String(localStorage.getItem("changedCarNameValue"))),localStorage.getItem("changedCarColorValue")!==null&&(this.changedCarColorValue=String(localStorage.getItem("changedCarColorValue")))}setLocalData(){localStorage.setItem("page",String(this.page))}setCarNameLocalData(){localStorage.setItem("carNameValue",this.carNameValue)}setCarColorLocalData(){localStorage.setItem("carColorValue",this.carColorValue)}setCarNameChangedLocalData(){localStorage.setItem("changedCarNameValue",this.changedCarNameValue)}setCarColorChangedLocalData(){localStorage.setItem("changedCarColorValue",this.changedCarColorValue)}createHtml(){this.container=document.createElement("section"),this.container.classList.add("garage-container"),this.garage=document.createElement("h1"),this.garage.classList.add("title"),this.garage.innerHTML="Garage",this.carContainer=document.createElement("div"),this.carContainer.classList.add("cars-container"),this.controlsCon=document.createElement("div"),this.controlsCon.classList.add("controls-con"),this.createBtns(),this.createPaginationControls(),this.createCars(),this.container.append(this.garage,this.controlsCon,this.carContainer)}createBtns(){var c;const e=document.createElement("input");e.value=this.carNameValue,e.addEventListener("blur",()=>{this.carNameValue=event.target.value,this.setCarNameLocalData()}),e.setAttribute("type","text"),e.id="createdCarName";const t=document.createElement("input");t.value=this.carColorValue,t.addEventListener("blur",()=>{this.carColorValue=event.target.value,this.setCarColorLocalData()}),t.setAttribute("type","color"),t.id="createdCarColor";const a=document.createElement("input");a.value=this.changedCarNameValue,a.value=this.changedCarNameValue,a.addEventListener("blur",()=>{this.changedCarNameValue=event.target.value,this.setCarNameChangedLocalData()}),a.setAttribute("type","text"),a.id="changeCarName";const n=document.createElement("input");n.value=this.changedCarColorValue,n.addEventListener("blur",()=>{this.changedCarColorValue=event.target.value,this.setCarColorChangedLocalData()}),n.setAttribute("type","color"),n.id="changeCarColor";const r=document.createElement("button");r.classList.add("btn"),r.addEventListener("click",()=>this.setHandler()),r.innerHTML="Create";const s=document.createElement("button");s.classList.add("btn"),s.addEventListener("click",()=>this.changeHandler()),s.innerHTML="Change";const o=document.createElement("button");o.classList.add("btn"),o.addEventListener("click",()=>{this.raceHandler()}),o.innerHTML="Race";const d=document.createElement("button");d.classList.add("btn"),d.addEventListener("click",()=>this.resetHandler()),d.innerHTML="Reset";const l=document.createElement("button");l.classList.add("btn"),l.addEventListener("click",()=>this.generateHandler()),l.innerHTML="Generate Cars",(c=this.controlsCon)==null||c.append(e,t,r,a,n,s,o,d,l)}createPaginationControls(){var r;const e=document.createElement("button");e.addEventListener("click",()=>this.nextPage()),e.innerHTML="Next";const t=document.createElement("button");t.addEventListener("click",()=>this.prevPage()),t.innerHTML="Prev";const a=document.createElement("h3");a.innerHTML=String(this.page),a.classList.add("page-number");const n=document.createElement("div");n.classList.add("pagination-container"),n.append(t,a,e),(r=this.controlsCon)==null||r.append(n)}nextPage(){this.page++,this.createCars();const e=document.querySelector(".page-number");e&&(e.innerHTML=String(this.page)),this.setLocalData()}prevPage(){if(this.page===1)return;this.page--,this.createCars();const e=document.querySelector(".page-number");e!==null&&(e.innerHTML=String(this.page)),this.setLocalData()}async createCars(){var e;try{this.carContainer&&(this.carContainer.innerHTML=""),this.data=await h.getCars(7,this.page),Array.isArray(this.data)&&((e=this.data)==null||e.forEach(t=>{var f;const a=document.createElement("div");a.classList.add("car-container");const n=document.createElement("h3");n.innerHTML=t.name,n.classList.add("car-name");const r=`<svg xmlns="http://www.w3.org/2000/svg" id="carSvg" width="120" height="120" fill="${t.color}" viewBox="0 0 256 256" xml:space="preserve">
                        <path d="M212.435 174.994c-13.098 0-23.753-10.655-23.753-23.753s10.655-23.753 23.753-23.753 23.753 10.656 23.753 23.753-10.656 23.753-23.753 23.753zm0-39.076c-8.45 0-15.323 6.874-15.323 15.323s6.873 15.323 15.323 15.323 15.323-6.873 15.323-15.323-6.876-15.323-15.323-15.323zM51.478 174.994c-13.097 0-23.753-10.655-23.753-23.753s10.656-23.753 23.753-23.753 23.753 10.656 23.753 23.753-10.656 23.753-23.753 23.753zm0-39.076c-8.447 0-15.323 6.874-15.323 15.323s6.873 15.323 15.323 15.323 15.323-6.873 15.323-15.323-6.873-15.323-15.323-15.323z"/>
                        <path d="M212.438 159.663a8.459 8.459 0 0 1-5.958-2.473 7.806 7.806 0 0 1-1.067-1.262 9.018 9.018 0 0 1-.76-1.464 6.231 6.231 0 0 1-.477-1.573 8.33 8.33 0 0 1-.171-1.66c0-.532.059-1.097.171-1.628.082-.562.253-1.07.478-1.602.194-.505.478-.986.759-1.433.309-.477.674-.899 1.067-1.292.366-.396.815-.734 1.265-1.04.478-.309.955-.562 1.464-.787a10.073 10.073 0 0 1 1.574-.477 8.236 8.236 0 0 1 3.315 0c.534.112 1.04.28 1.577.477.506.225.983.478 1.433.787.478.306.899.644 1.292 1.04.394.393.731.815 1.04 1.292.31.447.562.928.787 1.433.194.532.365 1.04.478 1.602.112.531.168 1.096.168 1.627 0 .562-.056 1.099-.168 1.66a10.581 10.581 0 0 1-.478 1.574c-.225.506-.478.984-.787 1.464-.309.447-.646.897-1.04 1.262a7.64 7.64 0 0 1-1.292 1.068c-.45.284-.927.562-1.433.761-.534.225-1.04.394-1.577.478a8.553 8.553 0 0 1-1.66.166zM51.48 159.663a8.299 8.299 0 0 1-1.657-.169c-.534-.112-1.068-.253-1.574-.477-.506-.197-.983-.478-1.46-.762a8.718 8.718 0 0 1-1.265-1.068 8.47 8.47 0 0 1-2.473-5.957c0-.53.056-1.096.168-1.627.113-.534.253-1.07.478-1.576.197-.531.478-1.012.759-1.461.309-.478.674-.9 1.068-1.293a8.515 8.515 0 0 1 1.264-1.04c.478-.309.955-.562 1.461-.787.506-.196 1.04-.365 1.574-.477a8.098 8.098 0 0 1 3.288 0c.562.112 1.067.28 1.601.477.506.225.984.478 1.433.787.478.307.9.644 1.293 1.04.393.393.73.815 1.04 1.293.309.446.562.927.786 1.46.197.507.366 1.04.478 1.577.113.531.169 1.096.169 1.627 0 2.22-.9 4.412-2.473 5.957a7.64 7.64 0 0 1-1.293 1.068c-.45.284-.927.562-1.433.762-.506.224-1.04.365-1.601.477a7.83 7.83 0 0 1-1.63.169z"/>
                        <rect id="carSvg"/>
                        <path d="m225.53 116.243-41.322-10.597-19.695-11.428a100.079 100.079 0 0 0-50.164-13.502H84.625c-19.176 0-37.494 7.168-51.578 20.184a10.864 10.864 0 0 1-7.401 2.895h-6.29c-7.637 0-14.086 5.718-15.002 13.302l-2.846 23.64a13.903 13.903 0 0 0 9.09 14.787l12.923 4.693a29.276 29.276 0 0 1-1.416-8.978c0-16.197 13.176-29.373 29.373-29.373s29.373 13.176 29.373 29.373c0 4.442-1.02 8.64-2.793 12.42h107.797c-1.773-3.78-2.793-7.978-2.793-12.42 0-16.197 13.176-29.373 29.373-29.373s29.373 13.176 29.373 29.373c0 3.875-.773 7.567-2.142 10.956l8.192-1.31a7.621 7.621 0 0 0 6.449-7.559c0-17.486-11.836-32.736-28.778-37.083zM77.1 111.457c-3.673 0-7.003-1.714-9.136-4.7-2.135-2.988-2.678-6.694-1.486-10.167l1.843-5.384c5.291-1.313 10.748-2.057 16.307-2.057h6.46l9.458 22.308H77.1zm82.673 0H109.7l-9.458-22.308h14.106a91.628 91.628 0 0 1 45.932 12.361l12.876 7.469c-4.288 1.613-8.77 2.478-13.384 2.478z"/>
                    </svg>`,s=document.createElement("div");s.innerHTML=r,s.classList.add("car-logo"),s.id=`car-${t.id}`;const o=document.createElement("div");o.classList.add("move-car"),o.id=`move-car-${t.id}`;const d=document.createElement("div");d.classList.add("race"),d.append(o,s);const l=document.createElement("button");l.id=`start-btn-${t.id}`,l.innerHTML="S",l.addEventListener("click",p=>{const m=p==null?void 0:p.target;if(m){m.disabled=!0;const L=document.getElementById(`stop-btn-${t.id}`);L&&(L.disabled=!1),this.selected=t;const E=t.id;this.startHandler(E)}});const c=document.createElement("button");c.id=`stop-btn-${t.id}`,c.innerHTML="D",c.disabled=!0,c.addEventListener("click",p=>{const m=p==null?void 0:p.target;if(m){m.disabled=!0;const L=document.getElementById(`start-btn-${t.id}`);L&&(L.disabled=!1),this.selected=t;const E=t.id;this.stopHandler(E)}});const u=document.createElement("button");u.id="btn-select",u.addEventListener("click",p=>{const m=p.target;(m==null?void 0:m.parentNode).classList.add("selected"),this.selected=t,this.selectCarHandler()}),u.innerHTML="Select";const g=document.createElement("button");g.addEventListener("click",()=>{this.selected=t,this.deleteCarHandler()}),g.innerHTML="Delete",a.append(n,l,c,u,g,d),this.updatePage(),(f=this.carContainer)==null||f.append(a)}))}catch{console.log("something go wrong")}}async updatePage(){try{const e=await h.getCars();this.garage?this.garage.innerHTML=`Garage(${e})`:console.error("Garage element not found.")}catch(e){console.error("Error updating page:",e)}}async changeHandler(){if(this.selected)try{const e=document.getElementById("changeCarName").value,t=document.getElementById("changeCarColor").value,a=await h.updateCar(e!==""?e:null,t!==""?t:null,this.selected.id,this.selected.name,this.selected.color);console.log(a),e!==""&&(this.selected.name=e),t!==""?this.selected.color=t:this.selected.color,await this.createCars()}catch{}}async setHandler(){try{const e=document.getElementById("createdCarName").value,t=document.getElementById("createdCarColor").value,a=await h.createCar(e,t);console.log(a),await this.createCars(),console.log("succeed")}catch(e){console.log(e)}}async raceHandler(){if(Array.isArray(this.data)){const e=this.data.map(a=>a.id);console.log(e);const t=e.map(a=>this.startHandler(a));console.log(t,"cars array"),Promise.all(t).then(a=>{console.log(a);const n=a.filter(r=>r.state==="finished");if(n.length>0){const r=n.sort((s,o)=>s.time-o.time)[0];console.log(r.id),this.winHandler(r.id,r.time)}}).catch(a=>{console.error("Ошибка:",a)})}console.log("race")}async resetHandler(){if(Array.isArray(this.data)){const a=this.data.map(n=>n.id).map(n=>this.stopHandler(n));await Promise.race(a)}const e=document.getElementById("modal-con");e&&e.remove()}async startHandler(e){const a=await h.startStopEngine(e,"started"),n=window.innerWidth,r=120*2,s=n-r,o=document.getElementById(`move-car-${e}`);o&&(o.style.maxWidth=s+"px");const d=a.velocity/a.distance*s;let l=0;const c=h.switchToDrive(e,"drive",this.stopDrive.bind(this));this.intervals[e]=setInterval(()=>{l>=s&&clearInterval(this.intervals[e]),c||clearInterval(this.intervals[e]),l+=d*10,o&&(o.style.width=l+"px")},10);const u=Date.now();return c.then(g=>{clearInterval(this.intervals[e]);const f=Date.now();if(g instanceof Object&&"success"in g&&g.success)return{state:"finished",id:e,time:f-u};throw new Error("test")}).catch(g=>(clearInterval(this.intervals[e]),{state:"broken",id:e}))}stopDrive(){console.log("work")}async stopHandler(e){const t=await h.startStopEngine(e,"stopped");console.log(t),clearInterval(this.intervals[e]);const a=document.getElementById(`move-car-${e}`);a&&(a.style.width="0px")}async generateHandler(){console.log("generate");const e=await h.randomCars();console.log(e),await this.createCars()}async selectCarHandler(){}async deleteCarHandler(){if(this.selected)try{const e=await h.deleteCar(this.selected.id);if(console.log("deleted",e),await this.createCars(),"id"in this.selected){const t=await h.getWinner(this.selected.id),a=await h.deleteWinner(this.selected.id);console.log(t,a)}}catch(e){console.log(`${e} do not deleted`)}}async winHandler(e,t){var d,l;const a=document.createElement("div");a.classList.add("modal-con"),a.id="modal-con";const n=document.createElement("h1");if(n.classList.add("modal-text"),Array.isArray(this.data))var r=(d=this.data)==null?void 0:d.find(c=>c.id===e);r&&(n.innerHTML=`${r.name} wins the race in ${t/1e3}s`),a.append(n),(l=this.container)==null||l.append(a);let s="";r&&(s=r.name);const o=await h.getWinner(e);if(o.length===0){const c=await h.createWinner(e,s,t,1);console.log(c)}else{const c=o.find(f=>f.id===e);let u=Number(c.wins);u++;const g=await h.updateWinner(e,u,t,c.name);console.log(g)}}getHtml(){return this.container}}class H{constructor(){i(this,"container");i(this,"page");i(this,"totalPages");i(this,"sortDescending");this.container=null,this.page=1,this.totalPages=0,this.sortDescending=!0,this.init()}init(){this.getData(),this.createHtml()}async getData(){const e=await h.getWinner();this.totalPages=Math.ceil(e.length/10)}createHtml(){this.container=document.createElement("section"),this.container.classList.add("winner-container"),this.createTable(),this.createPagination()}async createTable(){var u;const e=document.createElement("table");e.classList.add("table-winners"),e.id="table";const t=document.createElement("tr"),a=document.createElement("th");a.innerHTML="Model";const n=document.createElement("th");n.innerHTML="Time";const r=document.createElement("th");r.innerHTML="Wins",n.addEventListener("click",()=>this.sortTable("time")),r.addEventListener("click",()=>this.sortTable("wins")),t.append(a,n,r),e.append(t);const s=await h.getWinner(),o=await h.getCars(10,this.page),d=(this.page-1)*10,l=d+10;s.slice(d,l).forEach((g,f=0)=>{const p=document.createElement("tr"),m=document.createElement("td");m.textContent=g.name,o!=null&&(m.style.color=o[f].color);const L=document.createElement("td");L.textContent=`${g.time/1e3}s`;const E=document.createElement("td");E.textContent=String(g.wins),p.append(m,L,E),e.append(p),f++}),(u=this.container)==null||u.append(e)}sortTable(e){const t=document.getElementById("table");if(!t)return;const a=Array.from(t.querySelectorAll("tr")),n=a.shift();a.sort((r,s)=>{var l,c;const o=((l=r.querySelector(`td:nth-child(${this.getColumnIndex(e)})`))==null?void 0:l.textContent)??"",d=((c=s.querySelector(`td:nth-child(${this.getColumnIndex(e)})`))==null?void 0:c.textContent)??"";return e==="name"?o>d?1:-1:e==="time"?Number(o.slice(0,-1))-Number(d.slice(0,-1)):Number(o)-Number(d)}),this.sortDescending=!this.sortDescending,this.sortDescending&&a.reverse(),t.innerHTML="",t.append(n,...a)}getColumnIndex(e){const t=document.querySelector("#table tr:first-child");return t?Array.from(t.querySelectorAll("th")).findIndex(n=>{var r;return((r=n.textContent)==null?void 0:r.toLowerCase().trim())===e})+1:-1}createPagination(){var r;const e=document.createElement("div");e.classList.add("pagination-container");const t=document.createElement("button");t.classList.add("next-btn"),t.innerHTML="Next",t.addEventListener("click",()=>this.nextHandeler());const a=document.createElement("button");a.classList.add("prev-btn"),a.innerHTML="prev",a.addEventListener("click",()=>this.prevHandeler());const n=document.createElement("h3");n.classList.add("number-page"),n.innerHTML=String(this.page),e.append(a,n,t),(r=this.container)==null||r.prepend(e)}nextHandeler(){if(this.page<this.totalPages){this.page++;const e=document.getElementById("table");e&&e.remove(),this.createTable()}}prevHandeler(){if(this.page>1){this.page--;const e=document.getElementById("table");e&&e.remove(),this.createTable()}}getHtml(){return this.container}}class T{constructor(e){i(this,"parent");i(this,"container");i(this,"controls");i(this,"garage");i(this,"winners");this.parent=e,this.container=null,this.controls=null,this.garage=null,this.winners=null,this.init()}init(){this.container=document.createElement("section"),this.container.classList.add("main-container"),this.parent.append(this.container),this.loadPage()}loadPage(){this.controls=new w(this.loadGarage.bind(this),this.loadWinners.bind(this)),this.parent.prepend(this.controls.getControls()),this.loadGarage()}async loadGarage(){var e;console.log("garage"),this.clearContainer(),this.garage=new b,(e=this.container)==null||e.append(this.garage.getHtml())}loadWinners(){var e;console.log("winners"),this.clearContainer(),this.winners=new H,(e=this.container)==null||e.append(this.winners.getHtml())}clearContainer(){const e=this.container;e&&(e.innerHTML="")}}new T(document.body);
